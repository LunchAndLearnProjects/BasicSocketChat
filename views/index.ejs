<!DOCTYPE HTML>
<html>
  <head>
    <title>Socket.IO chat</title>
    <link rel="stylesheet" href="/stylesheets/bootstrap.css"/>
  </head>
  <body>
    <div class="container mb-5">
      <div id="messages"></div>
    </div>

    <form class="fixed-bottom" action="">
      <div class="input-group">
        <input id="m" class="form-control" placeholder="Type here..." autocomplete="off">
        <span class="input-group-btn">
          <button class="btn btn-secondary" type="submit">Send</button>
        </span>
      </div>
    </form>
    <script src="/scripts/socket.io.js"></script>
    <script src="/scripts/jquery.js"></script>
    <script src="/scripts/tether.js"></script>
    <script src="/scripts/bootstrap.js"></script>
    <script>
      $(function(){
        var chatH = '<%= chatName %>';
        var socket = io('http://localhost:3000');
        $('form').submit(function(e){
          e.preventDefault();
          socket.emit('chat message', { chatHandle: chatH, message: $('#m').val() });
          $('#m').val('');
          return false;
        });
        socket.on('chat message', function(data){
          var messageColor;
          if (chatH != data.chatHandle)
            messageColor = 'success'
          else
            messageColor = 'info';
          $('#messages').append(
            $('<div class="row rounded m-2">').append(
              $('<div class="col-3 p-1">').append(
                $('<div class="text-' + messageColor + '">').text(data.chatHandle)
              ).append(
                $('<div class="text-muted">').text(data.date)
              )
            ).append(
              $('<div class="col-9 bg-' + messageColor + ' text-white p-1 pl-4 align-self-center">').text(data.message)
            )
          );
          $("html, body").animate({ scrollTop: $(document).height() }, "slow");
        });
      });
    </script>
  </body>
</html>
